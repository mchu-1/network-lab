var D=Object.defineProperty;var S=(m,c,e)=>c in m?D(m,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[c]=e;var l=(m,c,e)=>S(m,typeof c!="symbol"?c+"":c,e);import{r as A,g as v}from"./phaser-Czz4FBZH.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=e(t);fetch(t.href,i)}})();var T=A();const h=v(T);async function W(m){const e=await(await fetch(m)).text(),t=new DOMParser().parseFromString(e,"text/xml"),i=t.querySelector("map");if(!i)throw new Error("Invalid TMX file");const a={width:parseInt(i.getAttribute("width")||"0"),height:parseInt(i.getAttribute("height")||"0"),tileWidth:parseInt(i.getAttribute("tilewidth")||"16"),tileHeight:parseInt(i.getAttribute("tileheight")||"16"),tilesets:[],layers:[]};return t.querySelectorAll("tileset").forEach(o=>{const p=o.querySelector("image");if(!p)return;const d={firstgid:parseInt(o.getAttribute("firstgid")||"1"),name:o.getAttribute("name")||"",tileWidth:parseInt(o.getAttribute("tilewidth")||"16"),tileHeight:parseInt(o.getAttribute("tileheight")||"16"),tileCount:parseInt(o.getAttribute("tilecount")||"0"),columns:parseInt(o.getAttribute("columns")||"1"),imageSource:p.getAttribute("source")||"",imageWidth:parseInt(p.getAttribute("width")||"0"),imageHeight:parseInt(p.getAttribute("height")||"0"),properties:{},tileProperties:{}},f=o.querySelector(":scope > properties");f&&f.querySelectorAll("property").forEach(u=>{const g=u.getAttribute("name"),y=u.getAttribute("value");g&&y&&d.properties&&(d.properties[g]=isNaN(Number(y))?y:Number(y))}),o.querySelectorAll("tile").forEach(u=>{const g=parseInt(u.getAttribute("id")||"0"),y=u.querySelector("properties");y&&d.tileProperties&&(d.tileProperties[g]={},y.querySelectorAll("property").forEach(k=>{const b=k.getAttribute("name"),w=k.getAttribute("value");b&&w&&d.tileProperties&&(d.tileProperties[g][b]=isNaN(Number(w))?w:Number(w))}))}),a.tilesets.push(d)}),t.querySelectorAll("layer").forEach(o=>{const p=o.querySelector("data");if(!p)return;const d=p.getAttribute("encoding");let f=[];d==="csv"&&(f=(p.textContent||"").trim().split(",").map(y=>parseInt(y.trim())||0));const u={id:parseInt(o.getAttribute("id")||"0"),name:o.getAttribute("name")||"",width:parseInt(o.getAttribute("width")||"0"),height:parseInt(o.getAttribute("height")||"0"),data:f};a.layers.push(u)}),a}function x(m,c){let e=null;for(const s of m)c>=s.firstgid&&c<s.firstgid+s.tileCount&&(e=s);return e}class C extends h.Scene{constructor(){super({key:"BootScene"});l(this,"mapData")}preload(){const e=this.cameras.main.width,s=this.cameras.main.height,t=this.add.graphics(),i=this.add.graphics();i.fillStyle(2236962,.8),i.fillRect(e/2-160,s/2-25,320,50);const a=this.add.text(e/2,s/2-50,"Loading...",{font:"20px monospace",color:"#ffffff"}).setOrigin(.5,.5),r=this.add.text(e/2,s/2,"0%",{font:"18px monospace",color:"#ffffff"}).setOrigin(.5,.5);this.load.on("progress",n=>{r.setText(Math.round(n*100)+"%"),t.clear(),t.fillStyle(43263,1),t.fillRect(e/2-150,s/2-15,300*n,30)}),this.load.on("complete",()=>{t.destroy(),i.destroy(),a.destroy(),r.destroy()}),this.load.image("island-layer-0","assets/layers/island-layer-0.png"),this.load.image("island-layer-1","assets/layers/island-layer-1.png"),this.load.image("island-layer-2","assets/layers/island-layer-2.png"),this.load.image("island-layer-3","assets/layers/island-layer-3.png"),this.load.image("island-layer-4","assets/layers/island-layer-4.png"),this.load.image("island-layer-5","assets/layers/island-layer-5.png"),this.load.image("paraphernalia","assets/props/paraphernalia.png"),this.load.image("blue-and-white","assets/buildings/blue-and-white.png"),this.load.image("co-working-closed","assets/buildings/co-working-closed.png"),this.load.image("hotel-closed","assets/buildings/hotel-closed.png"),this.load.image("gym","assets/buildings/gym.png"),this.load.image("kk-mart-closed","assets/buildings/kk-mart-closed.png"),this.load.image("lab","assets/buildings/lab.png"),this.load.spritesheet("mathew","assets/characters/mathew.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("jackson","assets/characters/jackson.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("brahminy-kite","assets/life/brahminy-kite.png",{frameWidth:270,frameHeight:294}),this.load.spritesheet("monitor-lizard","assets/life/monitor-lizard.png",{frameWidth:360,frameHeight:294})}async create(){try{this.mapData=await W("map-v3.tmx"),console.log("Map loaded:",this.mapData),this.createTileFrames(),this.registry.set("mapData",this.mapData),this.scene.start("GameScene")}catch(e){console.error("Failed to load map:",e)}}createTileFrames(){this.mapData&&this.mapData.tilesets.forEach(e=>{let s=e.name;e.name==="island-0"?s="island-layer-0":e.name==="island-1"?s="island-layer-1":e.name==="island-2"?s="island-layer-2":e.name==="island-4"?s="island-layer-4":e.name==="island-5"&&(s="island-layer-5");const t=this.textures.get(s);if(!t||t.key==="__MISSING")return;const i=Math.ceil(e.tileCount/e.columns);for(let a=0;a<i;a++)for(let r=0;r<e.columns;r++){const n=a*e.columns+r;if(n>=e.tileCount)break;const o=`${e.name}_${n}`,p=r*e.tileWidth,d=a*e.tileHeight;t.has(o)||t.add(o,0,p,d,e.tileWidth,e.tileHeight)}console.log(`Created ${e.tileCount} frames for ${e.name}`)})}}class H extends h.Physics.Arcade.Sprite{constructor(e,s,t){super(e,s,t,"mathew",0);l(this,"cursors");l(this,"wasd");l(this,"moveSpeed",150);l(this,"facing","down");e.add.existing(this),e.physics.add.existing(this),this.setScale(.35),this.setDepth(100);const i=this.body;i.setSize(60,80),i.setOffset(34,40),i.setCollideWorldBounds(!0),e.input.keyboard&&(this.cursors=e.input.keyboard.createCursorKeys(),this.wasd={W:e.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.W),A:e.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.A),S:e.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.S),D:e.input.keyboard.addKey(h.Input.Keyboard.KeyCodes.D)}),this.createAnimations()}createAnimations(){const e=this.scene.anims;e.exists("player-walk-down")||e.create({key:"player-walk-down",frames:e.generateFrameNumbers("mathew",{start:0,end:3}),frameRate:8,repeat:-1}),e.exists("player-walk-up")||e.create({key:"player-walk-up",frames:e.generateFrameNumbers("mathew",{start:4,end:7}),frameRate:8,repeat:-1}),e.exists("player-walk-right")||e.create({key:"player-walk-right",frames:e.generateFrameNumbers("mathew",{start:8,end:11}),frameRate:8,repeat:-1}),e.exists("player-walk-left")||e.create({key:"player-walk-left",frames:e.generateFrameNumbers("mathew",{start:12,end:15}),frameRate:8,repeat:-1}),e.exists("player-idle-down")||e.create({key:"player-idle-down",frames:[{key:"mathew",frame:0}],frameRate:1}),e.exists("player-idle-up")||e.create({key:"player-idle-up",frames:[{key:"mathew",frame:4}],frameRate:1}),e.exists("player-idle-right")||e.create({key:"player-idle-right",frames:[{key:"mathew",frame:8}],frameRate:1}),e.exists("player-idle-left")||e.create({key:"player-idle-left",frames:[{key:"mathew",frame:12}],frameRate:1})}update(){var o,p,d,f;if(!this.cursors||!this.wasd)return;const e=this.body,s=((o=this.cursors.left)==null?void 0:o.isDown)||this.wasd.A.isDown,t=((p=this.cursors.right)==null?void 0:p.isDown)||this.wasd.D.isDown,i=((d=this.cursors.up)==null?void 0:d.isDown)||this.wasd.W.isDown,a=((f=this.cursors.down)==null?void 0:f.isDown)||this.wasd.S.isDown;let r=0,n=0;s?r=-this.moveSpeed:t&&(r=this.moveSpeed),i?n=-this.moveSpeed:a&&(n=this.moveSpeed),r!==0&&n!==0&&(r*=.707,n*=.707),e.setVelocity(r,n),r!==0||n!==0?(Math.abs(r)>Math.abs(n)?this.facing=r>0?"right":"left":this.facing=n>0?"down":"up",this.anims.play(`player-walk-${this.facing}`,!0)):this.anims.play(`player-idle-${this.facing}`,!0)}}class M extends h.Physics.Arcade.Sprite{constructor(e,s,t,i="jackson",a=30){super(e,s,t,i,0);l(this,"moveSpeed");l(this,"wanderTimer");l(this,"currentDirection","down");this.moveSpeed=a,e.add.existing(this),e.physics.add.existing(this),this.setScale(.35),this.setDepth(99);const r=this.body;r.setSize(60,80),r.setOffset(34,40),r.setCollideWorldBounds(!0),this.createAnimations(),this.wanderTimer=e.time.addEvent({delay:h.Math.Between(2e3,5e3),callback:this.changeDirection,callbackScope:this,loop:!0}),this.changeDirection()}createAnimations(){const e=this.scene.anims;e.exists("npc-walk-down")||e.create({key:"npc-walk-down",frames:e.generateFrameNumbers("jackson",{start:0,end:3}),frameRate:6,repeat:-1}),e.exists("npc-walk-up")||e.create({key:"npc-walk-up",frames:e.generateFrameNumbers("jackson",{start:4,end:7}),frameRate:6,repeat:-1}),e.exists("npc-walk-right")||e.create({key:"npc-walk-right",frames:e.generateFrameNumbers("jackson",{start:8,end:11}),frameRate:6,repeat:-1}),e.exists("npc-walk-left")||e.create({key:"npc-walk-left",frames:e.generateFrameNumbers("jackson",{start:12,end:15}),frameRate:6,repeat:-1}),e.exists("npc-idle")||e.create({key:"npc-idle",frames:[{key:"jackson",frame:0}],frameRate:1})}changeDirection(){const e=["up","down","left","right","idle","idle"];this.currentDirection=e[h.Math.Between(0,e.length-1)],this.wanderTimer.reset({delay:h.Math.Between(1500,4e3),callback:this.changeDirection,callbackScope:this,loop:!0})}update(){const e=this.body;switch(this.currentDirection){case"up":e.setVelocity(0,-this.moveSpeed),this.anims.play("npc-walk-up",!0);break;case"down":e.setVelocity(0,this.moveSpeed),this.anims.play("npc-walk-down",!0);break;case"left":e.setVelocity(-this.moveSpeed,0),this.anims.play("npc-walk-left",!0);break;case"right":e.setVelocity(this.moveSpeed,0),this.anims.play("npc-walk-right",!0);break;default:e.setVelocity(0,0),this.anims.play("npc-idle",!0)}}destroy(e){this.wanderTimer&&this.wanderTimer.destroy(),super.destroy(e)}}class I extends h.GameObjects.Sprite{constructor(e,s,t,i,a){super(e,s,t,"brahminy-kite",0);l(this,"moveSpeed",60);l(this,"targetX");l(this,"targetY");l(this,"mapWidth");l(this,"mapHeight");this.mapWidth=i,this.mapHeight=a,e.add.existing(this),this.setScale(.2),this.setDepth(200),this.createAnimations(),this.anims.play("kite-fly",!0),this.targetX=s,this.targetY=t,this.pickNewTarget(),e.time.addEvent({delay:h.Math.Between(3e3,8e3),callback:this.pickNewTarget,callbackScope:this,loop:!0})}createAnimations(){const e=this.scene.anims;e.exists("kite-fly")||e.create({key:"kite-fly",frames:e.generateFrameNumbers("brahminy-kite",{start:0,end:7}),frameRate:8,repeat:-1})}pickNewTarget(){this.targetX=h.Math.Between(200,this.mapWidth-200),this.targetY=h.Math.Between(200,this.mapHeight-200)}update(e,s){const t=this.targetX-this.x,i=this.targetY-this.y,a=Math.sqrt(t*t+i*i);if(a>10){const r=this.moveSpeed*(s/1e3);this.x+=t/a*r,this.y+=i/a*r,this.flipX=t<0}else this.pickNewTarget()}}class $ extends h.Physics.Arcade.Sprite{constructor(e,s,t){super(e,s,t,"monitor-lizard",0);l(this,"moveSpeed",25);l(this,"wanderTimer");l(this,"currentDirection","idle");e.add.existing(this),e.physics.add.existing(this),this.setScale(.15),this.setDepth(98);const i=this.body;i.setSize(200,150),i.setOffset(80,100),i.setCollideWorldBounds(!0),this.createAnimations(),this.wanderTimer=e.time.addEvent({delay:h.Math.Between(2e3,6e3),callback:this.changeDirection,callbackScope:this,loop:!0}),this.changeDirection()}createAnimations(){const e=this.scene.anims;e.exists("lizard-walk")||e.create({key:"lizard-walk",frames:e.generateFrameNumbers("monitor-lizard",{start:0,end:5}),frameRate:6,repeat:-1}),e.exists("lizard-idle")||e.create({key:"lizard-idle",frames:[{key:"monitor-lizard",frame:0}],frameRate:1})}changeDirection(){const e=["left","right","idle","idle","idle"];this.currentDirection=e[h.Math.Between(0,e.length-1)],this.wanderTimer.reset({delay:h.Math.Between(2e3,6e3),callback:this.changeDirection,callbackScope:this,loop:!0})}update(){const e=this.body;switch(this.currentDirection){case"left":e.setVelocity(-this.moveSpeed,0),this.anims.play("lizard-walk",!0),this.flipX=!0;break;case"right":e.setVelocity(this.moveSpeed,0),this.anims.play("lizard-walk",!0),this.flipX=!1;break;default:e.setVelocity(0,0),this.anims.play("lizard-idle",!0)}}destroy(e){this.wanderTimer&&this.wanderTimer.destroy(),super.destroy(e)}}class L extends h.Scene{constructor(){super({key:"GameScene"});l(this,"player");l(this,"mapData");l(this,"mapWidth");l(this,"mapHeight");l(this,"collisionLayer",new Set);l(this,"npcs",[]);l(this,"kites",[]);l(this,"lizards",[])}create(){if(this.mapData=this.registry.get("mapData"),!this.mapData){console.error("No map data found!");return}this.mapWidth=this.mapData.width*this.mapData.tileWidth,this.mapHeight=this.mapData.height*this.mapData.tileHeight,console.log(`Map size: ${this.mapWidth}x${this.mapHeight} pixels`),this.physics.world.setBounds(0,0,this.mapWidth,this.mapHeight),this.renderMapLayers();const e=this.mapWidth/2,s=this.mapHeight/2;this.player=new H(this,e,s),this.setupCamera(),this.spawnNPCs(),this.spawnWildlife(),this.setupCollisions(),this.createUI()}getTextureKey(e){return e==="island-0"?"island-layer-0":e==="island-1"?"island-layer-1":e==="island-2"?"island-layer-2":e==="island-4"?"island-layer-4":e==="island-5"?"island-layer-5":e}renderMapLayers(){["water","sand","pavement","decorations","vehicles","buildings-base","buildings-top","sky"].forEach((s,t)=>{const i=this.mapData.layers.find(n=>n.name===s);if(!i){console.warn(`Layer ${s} not found`);return}console.log(`Rendering layer: ${s} with ${i.data.length} tiles`);const a=this.add.renderTexture(0,0,this.mapWidth,this.mapHeight);a.setOrigin(0,0),a.setDepth(t);const r=this.add.sprite(0,0,"__DEFAULT");r.setOrigin(0,0),r.setVisible(!1);for(let n=0;n<i.height;n++)for(let o=0;o<i.width;o++){const p=n*i.width+o,d=i.data[p];if(d===0)continue;const f=x(this.mapData.tilesets,d);if(!f)continue;const u=this.getTextureKey(f.name);if(!this.textures.exists(u))continue;const g=d-f.firstgid,y=`${f.name}_${g}`;if(!this.textures.get(u).has(y))continue;const b=o*this.mapData.tileWidth,w=n*this.mapData.tileHeight;r.setTexture(u,y),r.setPosition(b,w),a.draw(r),s==="water"&&this.collisionLayer.add(`${o},${n}`)}r.destroy()}),this.buildCollisionMap()}buildCollisionMap(){const e=this.mapData.layers.find(i=>i.name==="sand"),s=this.mapData.layers.find(i=>i.name==="pavement");if(e)for(let i=0;i<e.height;i++)for(let a=0;a<e.width;a++){const r=i*e.width+a;e.data[r]!==0&&this.collisionLayer.delete(`${a},${i}`)}if(s)for(let i=0;i<s.height;i++)for(let a=0;a<s.width;a++){const r=i*s.width+a;s.data[r]!==0&&this.collisionLayer.delete(`${a},${i}`)}const t=this.mapData.layers.find(i=>i.name==="buildings-base");if(t)for(let i=0;i<t.height;i++)for(let a=0;a<t.width;a++){const r=i*t.width+a,n=t.data[r];if(n!==0){const o=x(this.mapData.tilesets,n);o&&["blue-and-white","co-working-closed","hotel-closed","gym","kk-mart-closed","lab"].includes(o.name)&&this.collisionLayer.add(`${a},${i}`)}}console.log(`Collision tiles: ${this.collisionLayer.size}`)}setupCamera(){const e=this.cameras.main;e.setBounds(0,0,this.mapWidth,this.mapHeight),e.startFollow(this.player,!0,.08,.08),e.setDeadzone(100,100),e.setZoom(2)}spawnNPCs(){[{x:this.mapWidth/2+100,y:this.mapHeight/2+50},{x:this.mapWidth/2-150,y:this.mapHeight/2-100},{x:this.mapWidth/2+200,y:this.mapHeight/2-150}].forEach(s=>{const t=new M(this,s.x,s.y,"jackson",30);this.npcs.push(t)})}spawnWildlife(){for(let s=0;s<3;s++){const t=h.Math.Between(200,this.mapWidth-200),i=h.Math.Between(200,this.mapHeight-200),a=new I(this,t,i,this.mapWidth,this.mapHeight);this.kites.push(a)}[{x:this.mapWidth/2+300,y:this.mapHeight/2},{x:this.mapWidth/2-200,y:this.mapHeight/2+200}].forEach(s=>{const t=new $(this,s.x,s.y);this.lizards.push(t)})}setupCollisions(){}checkTileCollision(e,s,t,i){const a=Math.floor(e/this.mapData.tileWidth),r=Math.floor(s/this.mapData.tileHeight),n=Math.floor((e+t)/this.mapData.tileWidth),o=Math.floor((s+i)/this.mapData.tileHeight);for(let p=r;p<=o;p++)for(let d=a;d<=n;d++)if(this.collisionLayer.has(`${d},${p}`))return!0;return!1}createUI(){const e=this.add.container(0,0);e.setScrollFactor(0),e.setDepth(1e3);const s=this.add.text(10,10,"WASD / Arrow Keys to move",{font:"14px monospace",color:"#ffffff",backgroundColor:"#000000aa",padding:{x:8,y:4}});e.add(s);const t=this.add.text(10,40,"",{font:"12px monospace",color:"#88ff88",backgroundColor:"#000000aa",padding:{x:8,y:4}});e.add(t),this.time.addEvent({delay:200,callback:()=>{const i=Math.floor(this.player.x/this.mapData.tileWidth),a=Math.floor(this.player.y/this.mapData.tileHeight);t.setText(`Position: ${i}, ${a}`)},loop:!0})}update(e,s){if(this.player){const t=this.player.x,i=this.player.y;this.player.update();const a=this.player.body,r=a.width/2,n=a.height/2;this.checkTileCollision(this.player.x-r,this.player.y-n,a.width,a.height)&&(this.checkTileCollision(this.player.x-r,i-n,a.width,a.height)?this.checkTileCollision(t-r,this.player.y-n,a.width,a.height)?(this.player.x=t,this.player.y=i):this.player.x=t:this.player.y=i)}this.npcs.forEach(t=>{const i=t.x,a=t.y;t.update();const r=t.body,n=r.width/2,o=r.height/2;this.checkTileCollision(t.x-n,t.y-o,r.width,r.height)&&(t.x=i,t.y=a)}),this.kites.forEach(t=>t.update(e,s)),this.lizards.forEach(t=>{const i=t.x,a=t.y;t.update();const r=t.body,n=r.width/2,o=r.height/2;this.checkTileCollision(t.x-n,t.y-o,r.width,r.height)&&(t.x=i,t.y=a)})}}const N={type:h.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#1a5276",pixelArt:!0,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[C,L],scale:{mode:h.Scale.FIT,autoCenter:h.Scale.CENTER_BOTH}};new h.Game(N);
